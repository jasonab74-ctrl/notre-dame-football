<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notre Dame Football — News & Feeds</title>
  <link rel="icon" href="static/favicon.ico">
  <link rel="apple-touch-icon" href="static/apple-touch-icon.png">
  <link rel="manifest" href="static/manifest.json">
  <link rel="stylesheet" href="static/style.css">
  <meta name="color-scheme" content="light dark" />
</head>
<body>
  <header>
    <img class="logo" src="static/notre-dame-logo.png" alt="ND" />
    <div class="titles">
      <div class="brand">Notre Dame Football</div>
      <div class="subtitle">Live news feed • auto-refreshing</div>
    </div>
    <div class="actions">
      <button class="pill" id="fightBtn" title="Play fight song">Victory March</button>
    </div>
    <audio id="fightAudio" preload="none" src="static/fight-song.mp3"></audio>
  </header>

  <!-- Quick links -->
  <nav class="links" id="linksRow">
    <!-- Buttons come from STATIC_LINKS in feeds.py at build time; hardcoded here for static site -->
    <a class="pill" href="https://fightingirish.com/sports/football/schedule/" target="_blank" rel="noopener">Schedule</a>
    <a class="pill" href="https://fightingirish.com/sports/football/roster/" target="_blank" rel="noopener">Roster</a>
    <a class="pill" href="https://www.espn.com/college-football/standings" target="_blank" rel="noopener">Standings</a>
    <a class="pill" href="https://www.southbendtribune.com/sports/notre-dame/" target="_blank" rel="noopener">ND Insider</a>
    <a class="pill" href="https://www.irishenvy.com/forums/notre-dame-football.3/" target="_blank" rel="noopener">Irish Envy</a>
    <a class="pill" href="https://fightingirishwire.usatoday.com/" target="_blank" rel="noopener">Fighting Irish Wire</a>
    <a class="pill" href="https://www.onefootdown.com/" target="_blank" rel="noopener">One Foot Down</a>
    <a class="pill" href="https://www.on3.com/teams/notre-dame-fighting-irish/" target="_blank" rel="noopener">Blue & Gold (On3)</a>
    <a class="pill" href="https://notredame.rivals.com/" target="_blank" rel="noopener">Inside ND Sports (Rivals)</a>
    <a class="pill" href="https://www.reddit.com/r/NotreDame/" target="_blank" rel="noopener">Reddit</a>
    <a class="pill" href="https://apnews.com/hub/ap-top-25-college-football-poll" target="_blank" rel="noopener">AP Poll</a>
    <a class="pill" href="https://coaches.poll/college-football/" target="_blank" rel="noopener">Coaches Poll</a>
    <a class="pill" href="https://www.cbssports.com/college-football/teams/ND/notre-dame-fighting-irish/" target="_blank" rel="noopener">CBS ND</a>
    <a class="pill" href="https://247sports.com/college/notre-dame/" target="_blank" rel="noopener">247Sports ND</a>
  </nav>

  <div id="updated">Updated: <span id="updatedAt">–</span></div>

  <div style="padding: 0 16px 8px;">
    <label for="sourceSel" style="font-size:12px; opacity:.85;">News sources:</label>
    <select id="sourceSel">
      <option value="">All sources</option>
    </select>
  </div>

  <main class="grid" id="grid"></main>

  <footer>
    <div>Auto-checking for new items…</div>
    <div><a href="items.json" target="_blank" rel="noopener">items.json</a></div>
  </footer>

  <script>
    const fightBtn = document.getElementById('fightBtn');
    const fightAudio = document.getElementById('fightAudio');
    fightBtn.addEventListener('click', () => {
      if (fightAudio.paused) { fightAudio.play().catch(()=>{}); } else { fightAudio.pause(); fightAudio.currentTime = 0; }
    });

    const grid = document.getElementById('grid');
    const sourceSel = document.getElementById('sourceSel');
    const updatedAt = document.getElementById('updatedAt');

    let allItems = [];
    let lastCount = 0;

    function fmtDate(s) {
      try { return new Date(s).toLocaleString(); } catch { return s || ''; }
    }

    function render(items) {
      grid.innerHTML = '';
      items.forEach(it => {
        const a = document.createElement('a');
        a.className = 'card';
        a.href = it.link || '#';
        a.target = '_blank';
        a.rel = 'noopener';
        a.innerHTML = `
          <div class="title">${(it.title||'').replace(/</g,'&lt;')}</div>
          ${it.summary ? `<div>${(it.summary||'').replace(/</g,'&lt;')}</div>` : ''}
          <div class="meta">
            <span>${(it.source||'').replace(/</g,'&lt;')}</span>
            <span class="dot"></span>
            <span>${fmtDate(it.published)}</span>
          </div>
        `;
        grid.appendChild(a);
      });
    }

    function populateSourceFilter(items) {
      const set = new Set(items.map(i => i.source).filter(Boolean));
      const current = sourceSel.value;
      sourceSel.innerHTML = '<option value="">All sources</option>';
      [...set].sort().forEach(src => {
        const opt = document.createElement('option');
        opt.value = src; opt.textContent = src;
        sourceSel.appendChild(opt);
      });
      if ([...set].includes(current)) sourceSel.value = current;
    }

    async function load() {
      try {
        const res = await fetch('items.json', {cache: 'no-cache'});
        const data = await res.json();
        allItems = data.items || [];
        updatedAt.textContent = data.updated || new Date().toLocaleString();
        populateSourceFilter(allItems);
        const filtered = sourceSel.value ? allItems.filter(i => i.source === sourceSel.value) : allItems;
        render(filtered);
        lastCount = allItems.length;
      } catch (e) {
        updatedAt.textContent = 'failed to load';
        console.error(e);
      }
    }

    sourceSel.addEventListener('change', () => {
      const filtered = sourceSel.value ? allItems.filter(i => i.source === sourceSel.value) : allItems;
      render(filtered);
    });

    load();
    setInterval(async () => {
      try {
        const res = await fetch('items.json', {cache: 'no-cache'});
        const data = await res.json();
        const count = (data.items || []).length;
        if (count > lastCount) {
          allItems = data.items;
          updatedAt.textContent = data.updated || new Date().toLocaleString();
          populateSourceFilter(allItems);
          const filtered = sourceSel.value ? allItems.filter(i => i.source === sourceSel.value) : allItems;
          render(filtered);
          lastCount = count;
        }
      } catch {}
    }, 300000);
  </script>
</body>
</html>
