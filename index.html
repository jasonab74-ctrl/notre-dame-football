<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Notre Dame Football</title>
  <link rel="icon" href="static/favicon.ico">
  <link rel="apple-touch-icon" href="static/apple-touch-icon.png">
  <link rel="stylesheet" href="static/style.css">
  <meta name="theme-color" content="#0C2340">
</head>
<body>
  <header>
    <img src="static/notre-dame-logo.png" class="logo" alt="ND">
    <div class="titles">
      <div class="brand">Notre Dame Football</div>
      <div class="subtitle">Live news feed · auto-refreshing</div>
    </div>
    <div class="actions">
      <button class="pill" id="songBtn">Victory March</button>
    </div>
  </header>

  <nav class="links" id="quickLinks"></nav>

  <div id="updated">Updated: —</div>

  <div class="controls">
    <label for="srcSel">News sources:</label>
    <select id="srcSel">
      <option value="*">All sources</option>
    </select>
  </div>

  <main class="grid" id="grid"></main>

  <footer>
    <div>Auto-checking for new items…</div>
    <a href="items.json">items.json</a>
  </footer>

  <audio id="song" preload="none" src="static/fight-song.mp3"></audio>

  <script>
    const els = {
      grid: document.getElementById('grid'),
      updated: document.getElementById('updated'),
      srcSel: document.getElementById('srcSel'),
      links: document.getElementById('quickLinks'),
      song: document.getElementById('song'),
      songBtn: document.getElementById('songBtn'),
    };

    // Inline the same STATIC_LINKS as feeds.py
    const STATIC_LINKS = [
      {"label":"Schedule","url":"https://fightingirish.com/sports/football/schedule/"},
      {"label":"Roster","url":"https://fightingirish.com/sports/football/roster/"},
      {"label":"AP Poll","url":"https://apnews.com/hub/ap-top-25-college-football-poll"},
      {"label":"Coaches Poll","url":"https://www.usatoday.com/sports/ncaaf/polls/coaches-poll/"},
      {"label":"ND Insider","url":"https://www.southbendtribune.com/sports/notre-dame/"},
      {"label":"Irish Envy","url":"https://www.irishenvy.com/forums/notre-dame-football.3/"},
      {"label":"Fighting Irish Wire","url":"https://fightingirishwire.usatoday.com/"},
      {"label":"One Foot Down","url":"https://www.onefootdown.com/"},
      {"label":"Blue & Gold (On3)","url":"https://www.on3.com/teams/notre-dame-fighting-irish/"},
      {"label":"Inside ND Sports (Rivals)","url":"https://notredame.rivals.com/"},
      {"label":"247Sports ND","url":"https://247sports.com/college/notre-dame/"},
      {"label":"CBS ND","url":"https://www.cbssports.com/college-football/teams/ND/notre-dame-fighting-irish/"},
      {"label":"Reddit","url":"https://www.reddit.com/r/NotreDame/"}
    ];

    function buildLinks(){
      els.links.innerHTML = STATIC_LINKS.map(l => `<a class="pill" href="${l.url}" target="_blank" rel="noopener">${l.label}</a>`).join('');
    }

    function escapeHtml(s){return (s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}
    function fmtTime(ts){return new Date(ts*1000).toLocaleString()}

    let all = {items:[]};

    function render(){
      const src = els.srcSel.value;
      const items = all.items.filter(i => src === '*' || i.source === src);
      els.grid.innerHTML = items.map(it => `
        <article class="card">
          <a class="title" href="${it.link}" target="_blank" rel="noopener">${escapeHtml(it.title)}</a>
          <div class="meta">${escapeHtml(it.source)} • ${fmtTime(it.ts)}</div>
        </article>
      `).join('');
    }

    async function load(){
      const r = await fetch('items.json?ts='+Date.now());
      const j = await r.json();
      all = j;
      els.updated.textContent = 'Updated: ' + new Date().toLocaleString();
      const set = new Set(j.items.map(i => i.source));
      els.srcSel.innerHTML = `<option value="*">All sources</option>` + [...set].map(s=>`<option>${escapeHtml(s)}</option>`).join('');
      render();
    }

    // Auto-refresh every 5m
    setInterval(load, 5*60*1000);
    els.srcSel.addEventListener('change', render);
    els.songBtn.addEventListener('click', () => {
      if (els.song.paused){ els.song.play(); els.songBtn.textContent='Pause'; }
      else { els.song.pause(); els.songBtn.textContent='Victory March'; }
    });

    buildLinks();
    load();
  </script>
</body>
</html>