<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ND Football — News & Feeds</title>
  <link rel="stylesheet" href="/static/style.css?v=20250906">
  <link rel="preload" href="/static/fight-song.mp3" as="audio">
</head>
<body>
  <header class="banner">
    <div class="brand">
      <div class="logo">ND</div>
      <div class="title">
        <h1>Notre Dame Football</h1>
        <div class="updated">Updated: {{ updated }}</div>
      </div>
    </div>
    <button id="fight-btn" class="pill">Victory March</button>
    <audio id="fight-audio" src="/static/fight-song.mp3" preload="auto"></audio>
  </header>

  <main class="container">
    <section class="filters">
      <label for="sourceFilter">News sources:</label>
      <select id="sourceFilter">
        <option value="">All sources</option>
        {% for s in sources %}
          <option value="{{ s }}">{{ s }}</option>
        {% endfor %}
      </select>
    </section>

    <section id="feed" class="feed">
      {% for it in items %}
      <article class="card" data-source="{{ it.source }}">
        <a href="{{ it.link }}" class="title-link" target="_blank" rel="noopener">
          {{ it.title }}
        </a>
        {% if it.summary %}
        <p class="summary">{{ it.summary }}</p>
        {% endif %}
        <div class="meta">
          <span class="source">{{ it.source }}</span>
          <span class="dot">•</span>
          <time>{{ it.published }}</time>
        </div>
      </article>
      {% endfor %}
    </section>
  </main>

<script>
// Fight song play/pause without layout shift
const btn = document.getElementById('fight-btn');
const audio = document.getElementById('fight-audio');
let playing = false;
btn.addEventListener('click', async () => {
  try {
    if (!playing) {
      await audio.play();
      playing = true;
      btn.textContent = 'Pause';
    } else {
      audio.pause();
      playing = false;
      btn.textContent = 'Victory March';
    }
  } catch(e) {
    console.error(e);
  }
});
audio.addEventListener('ended', ()=>{
  playing = false;
  btn.textContent = 'Victory March';
});

// Source filter
const sel = document.getElementById('sourceFilter');
sel.addEventListener('change', () => {
  const val = sel.value.trim();
  document.querySelectorAll('.card').forEach(c => {
    if (!val || c.dataset.source === val) c.style.display = '';
    else c.style.display = 'none';
  });
});
</script>
</body>
</html>
