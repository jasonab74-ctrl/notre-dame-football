<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notre Dame Football — News &amp; Feeds</title>
  <link rel="manifest" href="{{ url_for('static', filename='manifest.webmanifest') }}">
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

  <!-- Header (non-sticky, no scroll-jump) -->
  <header class="site-header">
    <div class="brand">
      <img class="brand-mark" src="{{ url_for('static', filename='logo-512.png') }}" alt="ND logo" />
      <div class="brand-text">
        <h1 class="site-title">Notre Dame Football</h1>
        <div class="site-subtitle">News &amp; Feeds</div>
        <div class="site-updated">Updated: {{ updated_human or updated }}</div>
      </div>
    </div>
    <button id="fightSongBtn" class="pill pill--cta">Victory March</button>
    <audio id="fightSong" preload="auto" src="{{ url_for('static', filename='fight-song.mp3') }}"></audio>
  </header>

  <!-- Quick links row -->
  <section class="quick-links">
    <!-- Feel free to add/remove pills below; they’re purely static links -->
    <a class="pill" href="https://fightingirish.com/" target="_blank" rel="noopener">Official Site</a>
    <a class="pill" href="https://fightingirish.com/sports/football/schedule/" target="_blank" rel="noopener">Schedule</a>
    <a class="pill" href="https://fightingirish.com/sports/football/roster/" target="_blank" rel="noopener">Roster</a>
    <a class="pill" href="https://www.espn.com/college-football/rankings" target="_blank" rel="noopener">CFB Rankings</a>
    <a class="pill" href="https://www.ndinsider.com/" target="_blank" rel="noopener">ND Insider</a>
    <a class="pill" href="https://www.onefootdown.com/" target="_blank" rel="noopener">One Foot Down</a>
    <a class="pill" href="https://slapthesign.com/" target="_blank" rel="noopener">Slap the Sign</a>
    <a class="pill" href="https://www.irishenvy.com/" target="_blank" rel="noopener">Irish Envy Forum</a>
    <a class="pill" href="https://www.youtube.com/channel/UCAMR05qSc5mfhVx20fDyAoQ" target="_blank" rel="noopener">YouTube — ND Football</a>
    <a class="pill" href="https://www.reddit.com/r/notredamefootball/" target="_blank" rel="noopener">Reddit — r/notredamefootball</a>
    <a class="pill" href="https://247sports.com/college/notre-dame/" target="_blank" rel="noopener">247Sports ND</a>
    <a class="pill" href="https://www.espn.com/college-football/team/_/id/87/notre-dame-fighting-irish" target="_blank" rel="noopener">ESPN ND Football</a>
    <a class="pill" href="https://www.cbssports.com/college-football/teams/ND/notre-dame-fighting-irish/" target="_blank" rel="noopener">CBS Sports ND</a>
    <a class="pill" href="https://www.on3.com/teams/notre-dame-fighting-irish/" target="_blank" rel="noopener">On3 — Blue &amp; Gold</a>
    <a class="pill" href="https://theathletic.com/team/notre-dame-fighting-irish/" target="_blank" rel="noopener">The Athletic — ND</a>
    <a class="pill" href="https://fightingirishwire.usatoday.com/" target="_blank" rel="noopener">Fighting Irish Wire</a>
  </section>

  <!-- Source filter -->
  <section class="filters">
    <label class="filter-label" for="sourceSelect">News sources:</label>
    <div class="filter-select-wrap">
      <select id="sourceSelect">
        <option value="all">All sources</option>
        {% for key, label in (sources or {}).items() %}
          <option value="{{ key }}">{{ label }}</option>
        {% endfor %}
      </select>
      <span class="select-caret">▾</span>
    </div>
  </section>

  <!-- Feed list -->
  <main id="feed" class="feed">
    {% for item in items %}
      <article class="card" data-source="{{ item.source_key or '' }}">
        <h3 class="card-title">
          <a href="{{ item.link }}" target="_blank" rel="noopener">{{ item.title }}</a>
        </h3>

        {% if item.summary %}
          <p class="card-summary">{{ item.summary }}</p>
        {% endif %}

        <div class="card-meta">
          <span class="meta-source">{{ item.source or item.source_name }}</span>
          <span class="meta-dot">•</span>
          <time class="meta-time" datetime="{{ item.published or '' }}">{{ item.when or item.published_human }}</time>
        </div>
      </article>
    {% endfor %}
  </main>

  <footer class="site-footer">
    <div class="footline">web-production-{{ app_id or '9597' }}.up.railway.app</div>
  </footer>

  <script>
    // Fight song: no layout jump (no scrollIntoView/hide/show)
    (function () {
      const audio = document.getElementById('fightSong');
      const btn   = document.getElementById('fightSongBtn');
      if (!audio || !btn) return;

      let isPlaying = false;

      function update() {
        btn.textContent = isPlaying ? 'Pause' : 'Victory March';
        btn.setAttribute('aria-pressed', String(isPlaying));
      }

      btn.addEventListener('click', () => {
        if (isPlaying) {
          audio.pause();
        } else {
          audio.play().catch(() => {}); // fail silently if autoplay blocked
        }
      });
      audio.addEventListener('play',  () => { isPlaying = true;  update(); });
      audio.addEventListener('pause', () => { isPlaying = false; update(); });
      audio.addEventListener('ended', () => { isPlaying = false; update(); });
    })();

    // Simple front-end filter (no network calls)
    (function () {
      const select = document.getElementById('sourceSelect');
      const cards  = Array.from(document.querySelectorAll('.card'));
      if (!select || !cards.length) return;

      select.addEventListener('change', () => {
        const v = select.value;
        cards.forEach(c => {
          const k = c.getAttribute('data-source') || '';
          c.style.display = (v === 'all' || v === k) ? '' : 'none';
        });
      });
    })();
  </script>
</body>
</html>